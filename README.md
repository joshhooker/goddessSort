# GODDESSSort

In its current form, all of your runs should be in separate folders (e.g. Run030, Run031, etc.) and should include a .ldf file from ORRUBA and the corresponding GRETINA files (Digest.dat, Global.dat, etc.).

### Table of contents
[Calibrations](#calibrations)

[Configuration](#configuration)

[Output](#output)

[Example Analysis Script](#script)

[To Do](#todo)

## Calibrations <a name="calibrations"></a>

These calibration files are not necessary to run. It is possible to run the unpacker without them and to use the extracted ADC values to convert to energy later.

### QQQ5(Down/Up)Calibrations.dat

Calibration files for the downstream (Down) or upstream (Up) QQQ5 detectors. In this configuration file, the columns are:

| Det | Ring | Intercept | Slope |
|:---:|:----:|:---------:|:-----:|

Rings 32-35 correspond to the back sides:

| Ring Number | Back Side Number |
|:-----------:|:----------------:|
|      32     |         0        |
|      33     |         1        |
|      34     |         2        |
|      35     |         3        |

### SuperX3(Down/Up)Calibrations.dat
Calibration files for the downstream (Down) or upstream (Up) SuperX3 detectors. In this configuration file, the columns are:

| Det Id | Strip | Back | Intercept | Slope |
|:------:|:-----:|:----:|:---------:|:-----:|

## Configuration <a name="configuration"></a>

The main setup for the GODDESS Unpacker lies in config.json. Currently, the config.json is in the following form using the 30P_dp experiment as an example:
```json
{
  "pathToFolders": "/path/to/data_folders/",
  "pathPrefix": "Run",
  "ldfPrefix": "p30dp",
  "outputPath": "/path/to/output_folder/",
  "copyCuts": true,
  "cutPrefix": "cut_p30dp",
  "useAllFolders": false,
  "runs": ["0255"],
  "BB10Threshold": 200,
  "QQQThreshold": 200,
  "SX3Threshold": 200,
  "ICTrackingThreshold": 200
}
```

*   pathToFolder

        The path to where the run folders are located.

*   pathPrefix

        The folder prefix for the given Runs. For a folder title 'Run0255', this should be just 'Run'.

*   ldfPrefix

        The .ldf prefix before the run number. For a file in Run0225, p30dp0255.ldf, this should be 'p30dp'.

*   outputPath

        Path to where the output files and trees should be written to.

*   copyCuts

        If cuts are located in each of the run folders, then this is the prefix. For a cut named cut_p30dp0255.root, this should be 'cut_p30dp'

*   cutPrefix

        If cuts are located in each of the run folders and you want them copied to the output path, then set this to true. False will not copy cuts to the output folder.

*   useAllFolders

        If true, scans for all folders in the pathToFolder path with the folder prefix pathPrefix and unpacks all found folders.

*   runs

        If 'useAllFolders' is set to false, only the run numbers in this variable be will unpacked.

*   BB10Threshold

        ADC threshold to record any BB10 hit.

*   QQQThreshold

        ADC threshold to record any QQQ hit.

*   SX3Threshold

        ADC threshold to record any SuperX3 hit.

*   ICTrackingThreshold

        ADC threshold for IC tracking. Shouldn't really matter if it's low enough. The highest wire hit in terms of ADC value is recorded.

## Output <a name="output"></a>

There are currently three output files for each run (labeled as ####) that is placed in the output path controlled by config.json:
*   **Run####.root**

        ROOT file for ORRUBA data.

*   **Run####_gretina.root**

        ROOT file generated by GRETINA unpacker. This tree requires the GRETINA libraries to be loaded to read the TTree.

*   **Run####_combined.root**

        ROOT file for ORRUBA + GRETINA events. Does not require any external library.


Current TTree structure in Run####_combined.root:

*   RunNumber : string

        Run number of the event (string)

*   BB10Mul   : BB10Mul/I

        Number of hits in BB10 detectors above threshold (int)

*   BB10Det   : BB10Det[BB10Mul]/I

        BB10 detector number for hit (int array of length BB10Mul)

*   BB10Strip : BB10Strip[BB10Mul]/I

        BB10 strip number in detector BB10Det for hit (int array of length BB10Mul)

*   BB10Channel : BB10Channel[BB10Mul]/I

        Channel number of hit (int array of length BB10Mul)

*   BB10ADC   : BB10ADC[BB10Mul]/I

        ADC value of hit (int array of length BB10Mul)

*   BB10Energy : BB10Energy[BB10Mul]/F

        (float array of length BB10Mul)


*   QQQ5Mul   : QQQ5Mul/I

        Number of hits in QQQ5 detectors above threshold (int)

*   QQQ5Upstream : QQQ5Upstream[QQQ5Mul]/B

        (bool array of length QQQ5Mul)

*   QQQ5Det   : QQQ5Det[QQQ5Mul]/I

        (int array of length QQQ5Mul)

*   QQQ5Ring  : QQQ5Ring[QQQ5Mul]/I

        (int array of length QQQ5Mul)

*   QQQ5RingChannel : QQQ5RingChannel[QQQ5Mul]/I

        (int array of length QQQ5Mul)

*   QQQ5Sector : QQQ5Sector[QQQ5Mul]/I

        (int array of length QQQ5Mul)

*   QQQ5SectorChannel : QQQ5SectorChannel[QQQ5Mul]/I

        (int array of length QQQ5Mul)

*   QQQ5RingADC : QQQ5RingADC[QQQ5Mul]/I

        (int array of length QQQ5Mul)

*   QQQ5RingEnergy : QQQ5RingEnergy[QQQ5Mul]/F

        (float array of length QQQ5Mul)

*   QQQ5SectorADC : QQQ5SectorADC[QQQ5Mul]/I

        (int array of length QQQ5Mul)

*   QQQ5SectorEnergy : QQQ5SectorEnergy[QQQ5Mul]/F

        (float array of length QQQ5Mul)

*   QQQ5Angle : QQQ5Angle[QQQ5Mul]/F

        (float array of length QQQ5Mul)

*   SX3Mul    : SX3Mul/I

        Number of hits in SuperX3 detectors above threshold (int)

*   SX3Upstream : SX3Upstream[SX3Mul]/B

        (bool array of length SX3Mul)

*   SX3Det    : SX3Det[SX3Mul]/I

        (int array of length SX3Mul)

*   SX3Sector : SX3Sector[SX3Mul]/I

        (int array of length SX3Mul)

*   SX3SectorChannel : SX3SectorChannel[SX3Mul]/I

        (int array of length SX3Mul)

*   SX3SectorADC : SX3SectorADC[SX3Mul]/I

        (int array of length SX3Mul)

*   SX3SectorEnergy : SX3SectorEnergy[SX3Mul]/F

        (float array of length SX3Mul)

*   SX3Strip  : SX3Strip[SX3Mul]/I

        (int array of length SX3Mul)

*   SX3StripLeftChannel : SX3StripLeftChannel[SX3Mul]/I

        (int array of length SX3Mul)

*   SX3StripRightChannel : SX3StripRightChannel[SX3Mul]/I

        (int array of length SX3Mul)

*   SX3StripLeftADC : SX3StripLeftADC[SX3Mul]/I

        (int array of length SX3Mul)

*   SX3StripRightADC : SX3StripRightADC[SX3Mul]/I

        (int array of length SX3Mul)

*   SX3StripEnergy : SX3StripEnergy[SX3Mul]/F

        (float array of length SX3Mul)

*   icdE      : icdE/I

        ADC value of dE detector in Ionization Chamber (int)

*   icE       : icE/I

        ADC value of E detector in Ionization Chamber (int)

*   icWireX   : icWireX/I

        (int)

*   icWireY   : icWireY/I

        (int)

*   icPositionX : icPositionX/F

        (float)

*   icPositionY : icPositionY/F

        (float)

*   icPositionWeightedX : icPositionWeightedX/F

        (float)

*   icPositionWeightedY : icPositionWeightedY/F

        (float)

*   tdcIC     : tdcIC/I

        (int)

*   tdcGRETINA : tdcGRETINA/I

        (int)

*   tdcRF     : tdcRF/I

        (int)

*   tdcSilicon : tdcSilicon/I

        (int)

*   timeStamp : timeStamp/l

        (unsigned long long)

*   GRETINATimeStamp : GRETINATimeStamp/l

        (unsigned long long)

*   xtalsMul  : xtalsMul/I

        Number of gammas detected (int)

*   xtals_cc  : xtals_cc[xtalsMul]/F

        (float array of length xtalsMul)

*   xtals_edop : xtals_edop[xtalsMul]/F

        (float array of length xtalsMul)

*   xtals_edopMaxInt : xtals_edopMaxInt[xtalsMul]/F

        (float array of length xtalsMul)

*   xtals_edopSeg : xtals_edopSeg[xtalsMul]/F

        (float array of length xtalsMul)

*   xtals_edopXtal : xtals_edopXtal[xtalsMul]/F

        (float array of length xtalsMul)

*   xtals_crystalNum : xtals_crystalNum[xtalsMul]/I

        (int array of length xtalsMul)

*   xtals_quadNum : xtals_quadNum[xtalsMul]/I

        (float array of length xtalsMul)

*   xtals_t0  : xtals_t0[xtalsMul]/F

        (float array of length xtalsMul)

*   xtals_timestamp : xtals_timestamp[xtalsMul]/L

        (long long array of length xtalsMul)

## Example Analysis Script <a name="script"></a>

## To Do <a name="todo"></a>

